# 增加节点
                                                 

## 本文简介：
本文介绍怎样在centos7上增加一个节点。

## 硬件要求：
* cpu ：4核  
* 内存：4G  
* 磁盘：至少50G

## 操作系统：
 * CentOS 7 

## 获取安装文件

 * 可以从github上直接[下载](https://github.com/uenctech/uenc-demo/tree/master/uenc)  适用于CentOS 7 环境下的二进制程序。
 
 你可以直接下载主网程序（uenc_xxx_primarynet.zip）
 ```
 wget https://github.com/uenctech/uenc-demo/raw/master/uenc/uenc_1.3_primarynet.zip
 ```
 或测试网程序(uenc_xxx_testnet.zip)
 ```
 wget https://github.com/uenctech/uenc-demo/raw/master/uenc/uenc_1.3_testnet.zip
 ```
 
 安装文件下载后解压，把解压后得到的文件解压缩。
 ```
 unzip uenc_1.3_testnet.zip
 ```

 修改执行权限
 ```
 chmod 755 uenc_1.3_testnet.zip
 ```
    
    
## 生成及配置配置文件：
 * 运行获取的安装文件
 ```
 ./uenc_1.3_testnet
 ```
 * 执行后按Ctrl + C退出当前程序，此时会在当前目录中生成如下文件或目录
 
 | 文件或目录 |     描述     | 
 | :--------: | :--------------: | 
 |   cert   | 存放生成的公私密钥对，后缀为".public.key"的文件是公钥文件，后缀为".private.key"为私钥文件 | 
 |   data.db   | 数据库文件 | 
 |   devpwd.json   | 本机访问密码哈希值，当移动端连接时使用该密码进行连接 | 
 |   config.json   | 配置文件 | 
 |   log.txt   | 日志文件 | 
 
 
 * 配置config.json

 子网节点无需配置，可按默认配置直接运行。
 
 公网节点按照如下方式进行修改：
 1. 需要将is_public_node的值由false修改为true。
 2. 将server中的IP字段的值设置为自身节点所连接的其他公网节点IP地址。
 3. 将var字段下的local_ip字段设置为自身节点的外网IP地址。
 
 例如，自身节点外网IP地址为xxx.xxx.xxx.xxx, 所连接公网地址为yyy.yyy.yyy.yyy, 则按如下配置（以测试网公网节点配置为例）
 ```
	  "is_public_node": false,
    "server": [
        {
            "IP": "yyy.yyy.yyy.yyy",
            "PORT": 11188
        },
    ],
    "var": {
    "k_bucket": "a0dbbd80eb84b9e51f3a0d69727384c651f9bdb5",
    "k_refresh_time": 100,
    "local_ip": "xxx.xxx.xxx.xxx",
    "local_port": 11188,
    "work_thread_num": 4
    },

 ```
 
           
## 节点运行：

 1. 运行安装文件的参数介绍：


|--help  |获取帮助菜单|
|:-------:|:---------:|
|-m       |显示菜单   |
|-s       |设置矿费   |
|-p       |设置打包费 |  

列如设置矿费：
```
    ./uenc_1.3_testnet -s  0.015
```

 
  注意：实际值 = value * 0.000001。实际值最小值：0.000001。


    
 2. 菜单介绍：


进入安装文件目录，运行安装文件且加参数-m.  
``` 
    ./uenc_1.3_testnet -m 
```
 此时会出现初始菜单：1.Transaction  2.Pledge  3.Redeem pledge  0.exit  
1.Transaction 表示发起交易，注意发起交易前需要设置矿费且矿费值在0.001与0.1之间.  
 输入1回车会让你输入自己的账号地址：
 ```
      input FromAddr :
      12GwpCQi7bWr8cbmU2r1aFia1rUQJDVXdo
 ```
 输入自己账号地址后回车此时会让你输入对方账号地址
 ```
     input ToAddr：
     1vkS46QffeM4sDMBBjuJBiVkMQKY7Z8Tu   
 ```
 输入对方账号地址后回车系统会提示让你输入交易金额
 ```
    input amount :
    999999 
 ```
 输入交易金额后回车系统会提示让你输入需要签名的数量，签名数量最大值15最小值6。
 ```
    input needVerifyPreHashCount :  
    6 
 ```
 输入签名数后回车系统提示你输入手续费注意手续费范围也是在0.001与0.1之间。
 ```
    input minerFees : 
          0.012
         
 ```
输入后回车交易发起完毕。  

                     
2.Pledge 表示质押。  
出现初始菜单后输入2回车注意此时质押的账号是你自己的本机账号，系统此时提示输入质押金额：
```
  请输入要质押金额：
        325555     
```
输入金额后回车系统提示你输入矿费
```
    请输入GasFee:
    0.014
```   
输入后回车系统提示你输入密码
```
     password:
     158660
```
输入密码后回车质押完毕。
  
  3.Redeem pledge表示解质押。  
输入3回车会提示你输入解质押的账号
```
     Selected redeem pledge.
addr：
     12GwpCQi7bWr8cbmU2r1aFia1rUQJDVXdo
```
输入后回车系统提示你选择要解质押的utxo
```
    utxo:
```
选择后回车解质押完毕(需确认和完善)。
       
0.exit退出系统。  
输入0回车退出系统。
           




##  手机连接：
      
#### 1.需要先下载app
   * 打开[官网](https://www.uenc.io/#/index) 扫最下方的二维码Fostoken安装app。  
#### 2.创建数字身份  
 * 安装成功后打开app。  
 * 此时要你创建你的数字身份，输入身份名密码和确认密码点击创建。   
#### 3.备份助记词  
 *  点击上一步的创建后进入提示你备份助记词的页面。  
 * 点击下一步（或者稍后备份）进行备份助记词。  
 * 然后点击下一步此时要你按刚才的助记词的顺序点击出现的助记词。  
#### 4.连接矿机  
 * 备份成功后，进入首页当前显示是主账号（高亮显示）。  
 * 进入首页还未连接矿机，点击矿机切换到矿机账号，点击+  进入矿机搜索列表。
 *   在矿机列表中选择一台矿机进行连接（备注：手机端必须连接wi-fi，且手机端wi-fi与连接的矿机在同一局域网内）
选择一台矿机，点击连接矿机，弹出输入密码框，矿机默认密码是12345678，输入密码。  
* 点击完成  
#### 5.设置燃料费  
* 矿机连接成功后点击立即设置进入设置燃料费界面，可以设置修改当前矿机燃料费。   
* 点击保存，返回矿机列表界面。  
#### 6.主账号发起转账  
* 回到首页点击转账按钮，进入转账页面。  
* 输入转账地址。  
* 选择单节点签名费。  
* 选择共识数。  
* 选择交易的公网。  
* 输入完成点击转账按钮。
* 进入确认转账界面 ，点击确认转账。  
* 提示交易发起成功，主账号转账发起成功。  
#### 7.矿机账号发起转账   
* 进入首页点击矿机切换到矿机账号。  
* 在矿机账号点击转账按钮，进入转账页面。  
* 输入转账地址。  
* 选择单节点签名费。  
* 选择共识数。  
* 输入完点击转账按钮按提示输入矿机密码。  
* 进入确认转账页面。  
* 点击确认转账按钮，交易发起成功。  
#### 8.主账号退出
* 点击钱包管理按钮，进入钱包管理界面。  
* 在钱包管理页面点击钱包地址右边的箭头进入设置页面。  
* 点击退出当前账号按钮 ，弹出输入密码，输入正确的密码退出账号，返回到注册页面。  
#### 9.恢复账号  
* 两种方式：1助记词恢复；2私钥恢复。  
* 在首页点击钱包管理按钮，进入钱包管理界面点击右下角的创建按钮。  
* 进入创建数字身份页面，点击最下面的恢复身份按钮进入恢复身份页面。   
* 选择助记词或私钥恢复身份。  
## 交易不成功可能原因 ：
#### 1.判断节点是否连接到服务器
   能否ping通公网服务。

 11187、11188、11190端口是否开放。
#### 2.看余额是否够即手续费+交易费是否小于余额

#### 3.是否设置矿费  
   
#### 4.本节点的块高度和全网节点的块高度是否一致  

  第2，3，4问题的解决：
  运行程序  
  ```
   ./uenc_1.3_testnet -m   
 ```  
运行起来后会出现如下信息：  
```
Version: 1_1.5_t
Base58: 15md8eripkG9n4hGMNacEar7AqTfudvWBZ
Balance: 0
Mac md5: 887da3c400cd1fcaf2d5431abcbc647d
Signature Fee: 1100
Package Fee: 0
Block top: 1919
Top block hash: d955017db4475742caeb9b9d143c7d9b79126b9c4e5cee1b55f735b00f42fdbd
```  
Balance是你的余额。你的交易费+矿费X（共识数-1）是你的本次交易总费用。看余额是否大于总费用。  
signature是矿费，看是否设置矿费，设置矿费：  
```
  ./uenc_1.3_testnet -s  0.015
```  
Block tops是块高度通过浏览器查看高度是否一致。


 

